name: Deploy Storybook

# Run this workflow every time a new commit pushed to your repository
on: push

jobs:
  # Set the job key. The key is displayed as the job name
  # when a job name is not provided
  deploy-storybook:
    # Name the Job
    name: Deploy Storybook to GitHub pages
    # Set the type of machine to run on
    runs-on: ubuntu-latest

    steps:
      # Checks out a copy of your repository on the ubuntu-latest machine
      - name: Checkout code
        uses: actions/checkout@v2

      - uses: actions/setup-node@v1
        with:
          node-version: '12'

      - name: Build Storybook
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git remote set-url origin "https://${secrets.GITHUB_TOKEN}@github.com/bbc/simorgh.git"
        # These user config values are needed to avoid an error being thrown.
        # These aren't used for authentication -the provided GitHub token is used instead.
          git config user.email "foo@bar.com"
          git config user.name "BBC News CI"
          npm install
          npm run build:storybook
          npx gh-pages@2.0.1 -d storybook_dist
