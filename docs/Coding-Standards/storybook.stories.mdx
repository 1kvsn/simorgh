import { Meta, Story } from '@storybook/addon-docs';
import figmaImage from './images/figma-link.png';
import storyIcon from './images/storybook-story-icon.png';
import groupIcon from './images/storybook-group-icon.png';
import folderIcon from './images/storybook-folder-icon.png';
import docsIcon from './images/storybook-docs-icon.png';
import figmaPreview from './images/figma-preview.png';

<Meta title="Coding Standards/Storybook" />

# Coding standards: storybook

## What is storybook

Storybook is a library developed and maintained by [chromatic](https://www.chromatic.com/?utm_source=storybook_website&utm_medium=link&utm_campaign=storybook).
Storybook is a frontend workshop for building UI components and pages in isolation.
More information about Storybook can be found [here](https://storybook.js.org/docs/react/get-started/why-storybook).

The World Service team adopted Storybook to share components with team members which have no access to Simorgh locally (e.g. UX, BA, etc...).
Furthermore, we use Storybook to a11y swarm components that cannot be deployed to test/live environments.

The latest update of our Storybook included the addition of the docs addon which allows previewing documentation in Storybook. Thus, storybook has recently become our main entry point to Simorgh's documentation.

## Storybook Tutorial

### Introduction - Essentials

Storybook works with path glob patterns that point to stories files. The glob patterns can be found in `.storybook/main.js`:

```jsx
stories: [
    '../docs/**/*.stories.mdx',
    '../src/app/legacy/components/**/*.stories.@(t|j)sx',
    '../src/app/legacy/containers/**/*.stories.@(t|j)sx',
    '../src/app/components/**/*.stories.@(t|j)sx',
    '../src/app/pages/**/*.stories.@(t|j)sx',
    './DocsDecorator/**/*.stories.@(t|j)sx',
    './SidebarLabel/**/*.stories.@(t|j)sx',
],
```

For any of our stories or documentation to correctly display in storybook we must ensure that the folder where they are stored is pointed by any of the above path glob patterns.

### How to add documentation

Make sure that the place where you store your documentation is pointed by any of the glob patterns in `.storybook/main.js`.
Then create an `.stories.mdx` file and write your documentation in normal markdown. Once you have finished, make sure to add these lines at the top of the file:

```jsx
import { Meta } from '@storybook/addon-docs';

//Title follows the path structure where the documentation needs to be stored. More about this is explained in later sections
<Meta title="Coding Standards/Storybook" />;

Your documentation should follow markdown format, documentation can be found [here](https://www.markdownguide.org/basic-syntax/)
```

The above code will allow storybook to grab the markdown you wrote below the `Meta` tag and display it in a story documentation.

### Creating a Basic component's story

To create a story for one of your components, co-locate a file called `index.stories.tsx` where your component's entry point (index.tsx/jsx) is located.
Inside this folder import your component and do a default export of the object showed below:

```jsx
import MyComponent from '.';

export default {
  // Title follows the path structure where the story needs to be stored. More about this is explained in later sections
  title: 'myComponent',
  // the component you want to display.
  component: MyComponent,
};
```

### Creating story for a component with variants

If your component has different behaviours depending on the props passed to it, you can create more variants with different props passed to it. All these variants will be displayed in the component's story.

```jsx
// Same as above but we will need React
import React from 'react';
import MyComponent from '.';

export default {
  title: 'myComponent',
  component: MyComponent,
};

// Export an arrow function with the variants of your components
export const Variant1 = () => <MyComponent prop1={variant1} />;

// The name declaration of this function will also be the name that storybook will give to this variant
export const Variant2 = () => <MyComponent prop1={variant2} />;
```

### Creating story for a component that require providers

To do this, we will first need to create a dummy component which nests out component to the provider our component needs.

```jsx
// Same as previous example + import the provider
import React from 'react';
import MyComponent from '.';
import Provider from './path/provider';

// Create a react component which takes in any needed props (these are used to create variants)
const MyComponentProvided = ({ prop1 }) => (
  // wrap your component inside the provider
  <Provider>
    <MyComponent prop1={prop1} />
  </Provider>
);

export default {
  title: 'myComponent',
  // pass the component that wrapped with provider instead of the basic component
  component: MyComponentProvided,
};

export const Variant1 = () => <MyComponent prop1={variant1} />;

export const Variantw = () => <MyComponent prop1={variant2} />;
```

### How to add component's documentation

To co-locate documentation to your component in storybook firstly co-locate a `README.md` or `README.mdx` file in the same location as the `index.stories.tsx`.
Write your documentation using [markdown](https://www.markdownguide.org/). Once your documentation is ready open the `index.stories.tsx`, import the newly created `README.md/mdx` as `md` and pass it down to the default export as showed below:

```jsx
import md from './README.md';

export default {
  title: 'myComponent',
  component: MyComponent,
  parameters: {
    docs: {
      component: {
        // H1 for the documentation
        title: 'My Component',
      },
      // The md file you imported
      page: md,
    },
  },
};
```

### How to add the health factors component

To update the health factors component for your component, co-locate a `metadata.json` file in your component's folder and write this object inside:

```json
{
  "lastUpdated": {
    // add the date you are updating this
    "day": 9,
    "month": "February",
    "year": 2023
  },
  "uxAccessibilityDoc": {
    // swap this value to true if you have added a link to the Documented screen reader UX
    "done": false,
    "reference": {
      // add a link to the Documented screen reader UX
      "url": "",
      "label": "Documented screen reader UX"
    }
  },
  "acceptanceCriteria": {
    "done": false,
    "reference": {
      "url": "add link of resource",
      "label": "Accessibility acceptance criteria"
    }
  },
  "swarm": {
    "done": false,
    "reference": {
      "url": "add link of resource",
      "label": "Accessibility swarm results"
    }
  }
}
```

Once created and modified for your component resources, open the `index.stories.tsx`, import the `metadata.json` as metadata, and add it to the default export object as follows:

```jsx
import metadata from './metadata.json';

export default {
  title: 'components/HealthFactors/HealthFactorsComponent',
  component: myComponent,
  parameters: {
    // The metadata you just imported
    metadata,
  },
};
```

Once this is done, our storybook will take care of adding the health factors component in the documentation tab. To know more of how this works look at our health factors component [documentation](https://latest--5d28eb3fe163f6002046d6fa.chromatic.com/?path=/docs/components-healthfactors-healthfactorscomponent--health-factors-with-complete-docs).

### How to add Figma previews

Preview example:

<img src={figmaPreview} alt="Figma preview tab in storybook" />

To create a sidebar windows with Figma or Zepplin UX designs, add the following `array of objects` to the parameters of your `index.stories.jsx` export:

```jsx
import myComponent

export default {
  title: 'components/HealthFactors/HealthFactorsComponent',
  component: myComponent,
  parameters: {
    design: [
      {
        // name of the tab
        name: 'Group 0',
        // type of showed
        type: 'figma',
        // link to the resource
        url: 'https://www.figma.com/file/OKzTxh7By6S0jj4U1Tgvug/Promos-(test-file)?node-id=4%3A259&t=rrFhi8jBxJykyAhM-0',
      },
      {
        name: 'Group 1',
        type: 'figma',
        url: 'https://www.figma.com/file/OKzTxh7By6S0jj4U1Tgvug/Promos-(test-file)?node-id=4%3A266&t=rrFhi8jBxJykyAhM-0',
      },
      .
      .
      .
      {
        name: 'Typography',
        type: 'figma',
        url: 'https://www.figma.com/file/OKzTxh7By6S0jj4U1Tgvug/Promos-(test-file)?node-id=2%3A63&t=rrFhi8jBxJykyAhM-0',
      },
      {
        name: 'States',
        type: 'figma',
        url: 'https://www.figma.com/file/OKzTxh7By6S0jj4U1Tgvug/Promos-(test-file)?node-id=6%3A492&t=rrFhi8jBxJykyAhM-0',
      },
    ],
  },
};
```

To get Figma URL which point to specific section of a design, select the design you want to display and copy the link showed by the browser:

<img
  src={figmaImage}
  alt="Image showing how to get a link from figma interface. Firstly select the component from the navigation, then copy the link provided by the browser"
/>

## Stories Standards

### Must have left-to-right & right-to-left variants.

#### Why?

Most of our components must work with both right-to-left and left-to-right typography. We must ensure a visual testing case for both these scenarios.

#### How?

Create and export a left-to-right and right-to-left variant:

```jsx
export const rightToLeft = <div />;
export const leftToRight = <div />;
```

### Must have an english variant.

#### Why?

When creating a story make sure to add at least one english language story for each component's variant. This can be done by modifying the `props` you are passing to your component.

Most of BBC staff in our team only understand English. With this premises it should be clear that writing our story in different language might
cause oversight in our part due to the added challenge of translating from a foreign language.
Furthermore, as already mentioned, we sometimes use storybook to a11y swarm components. As described in [Assistive technology testing in a foreign language](https://bbc.github.io/accessibility-news-and-you/assistive-technology/assistive-technology-testing-in-a-foreign-language.html),
we should:

> Make every effort when testing with assistive technology (AT), to test with content in a language you can understand.
> Even for an experienced AT user, navigating and reading content in a language that isn't understood would be challenging.

#### How?

Pass english metadata to your component.

## Folder Structure Standards

Storybook provides us with a simple folder structure. Item's in this structure can be:

- Root (showcased by a text label with the root's name)
- Folders
  <img src={folderIcon} alt="folder icon" style={{ width: '1rem' }} />
- Groups
  <img src={groupIcon} alt="group icon" style={{ width: '1rem' }} />
- Stories
  <img src={storyIcon} alt="story icon" style={{ width: '1rem' }} />
- Documentation
  <img src={docsIcon} alt="documentation icon" style={{ width: '1rem' }} />

The folder structure can be controlled via the story title by adding a path pattern:
`title="root_name/folder_name/name_of_story"`

You can have multiple nested folders:
`title="root_name/folder_name/.../folder_name/name_of_story`

e.g.
the file you are currently reading it titled `title="Coding Standards/Storybook"`
Note that in this case there is no folder.

Groups and folders can be both seen as containers. However groups are defined as containers that hold multiple stories. Whereas folder holds the groups, single stories, or mixture of these typologies.
At this stage, you should not worry about this difference as storybook automatically takes care of applying the correct container.

For more information about storybook hierarchy read [naming components and hierarchy](https://storybook.js.org/docs/react/writing-stories/naming-components-and-hierarchy)

### Stories must be inside a root and a folder/Group

You must make sure that each story is inside either a Story group or a folder.

### Why?

Better organisation of our components as well as allowing the health factors sidebar labels to work correctly.

### How?

❌

- story

❌

- root
  - story

✅

- root
  - folder
    - story

### Folders can only contain stories or groups, but not both.

#### Why?

Better organisation of our components as well as allowing the health factors sidebar labels to work correctly.

#### How?

❌

- root
  - folder
    - story
    - folder

✅

- root
  - folder
    - story
    - story

✅

- root
  - folder
    - folder
      - story
      - story
    - folder
      - story

### You must not go deeper than a two levels folder structure.

#### Why?

Avoid unnecessary nesting as well as allowing the health factors sidebar labels to work correctly.

#### How?

❌

- root
  - folder (level 1)
    - folder (level 2)
      - folder (level 3)
        - story

✅

- root
  - folder (level 1)
    - folder (level 2)
      - story

## Create a storybook checklist

- [ ] Create the index.stories.tsx co-located with the component
- [ ] Create the basic story
- [ ] Add ltr/rtl and english variants
- [ ] Add health factors component metadata
- [ ] Add component's documentation
- [ ] Add Figma links:
  - [ ] Group 0-5
  - [ ] Typography
  - [ ] States
  - [ ] Screen reader UX
- [ ] Praise yourself for the good work d(•́ω•̀)
